{% extends "layouts/dashboard.html" %}

{% block title %}Client page{% endblock %}

    {% block extra_css %}
        <link rel="stylesheet" href="{{ url_for('static', path='/css/client.css') }}">
        
    {% endblock %}

{% block content %}



<div class="container-fluid">
    <ol class="breadcrumb">
        <li><a href="#"><i class="fa fa-home"></i></a></li>
        <li class="active">Clients</li>
    </ol>

    <div class="filter-section clearfix">
        <div class="pull-left">
            <div class="btn-group actions-btn">
                <button type="button" class="btn btn-primary dropdown-toggle" data-toggle="dropdown">
                    Actions <span class="caret"></span>
                </button>
                <ul class="dropdown-menu">
                    <li><a href="#"><i class="fa fa-envelope"></i> Add Society</a></li>
                    <li><a href="#"><i class="fa fa-envelope"></i> Send Email</a></li>
                    <li><a href="#" id="edit-button" onclick="handleEdit()" disabled><i class="fa fa-pencil"></i> Edit</a></li>
                    <li><a href="#" id="delete-button" onclick="handleDelete()" disabled><i class="fa fa-trash"></i> Delete</a></li>
                    <li><a href="#"><i class="fa fa-ban"></i> Deactivate</a></li>
                </ul>
            </div>

            <div class="status-filter">
                Active <button type="button" class="close">&times;</button>
            </div>
        </div>

        <div class="pull-right">
            <div class="input-group filter-group">
                <input type="text" class="form-control" placeholder="Filter">
            </div>
                <button class="btn btn-success"><i class="fa fa-upload"></i> Import</button>
                <!-- <button class="btn btn-primary"><i class="fa fa-plus"></i> New Client</button> -->
                <a href="/clients/add" class="btn btn-primary">
                    <i class="fa fa-plus"></i> New Client
                </a>
        </div>
    </div>  

    <div class="table-responsive">
        <table class="table table-striped table-hover">
            <thead>
                <tr>
                    <th><input type="checkbox" onclick="handleCheckboxChange()"></th>
                    <th>NAME <i class="fa fa-sort"></i></th>
                    <th>CONTACT EMAIL <i class="fa fa-sort"></i></th>
                    <th>ID NUMBER <i class="fa fa-sort"></i></th>
                    <th>BALANCE <i class="fa fa-sort"></i></th>
                    <th>Adress<i class="fa fa-sort"></i></th>
                    <th>DATE CREATED <i class="fa fa-sort"></i></th>
                    <th>Notes<i class="fa fa-sort"></i></th>
                </tr>
            </thead>
            <tbody>
                {% for client in clients %}
                <tr>
                    <td><input type="checkbox" class="client-checkbox" id="checkboxID{{ client.id }}" value="{{ client.id }}" onclick="handleCheckboxChange()"></td>
                    <td>{{ client.name }}</td>
                    <td>{{ client.email }}</td>
                    <td>{{ client.idNumber }}</td>
                    <td>{{ client.idNumber }} â‚¬</td>
                    <td>{{ client.Billing_Street }}</td>
                    <td>{{ client.created_at }}</td>
                    <td>{{ client.notes }}</td>
                </tr>
                {% endfor %}
            </tbody>
        </table>
    </div>

    <div class="pagination-section clearfix">
        <div class="pull-left">
            <div class="form-inline">
                <select class="form-control">
                    <option>10</option>
                    <option>25</option>
                    <option>50</option>
                    <option>100</option>
                </select>
                <span class="text-muted">rows</span>
            </div>
        </div>
        <div class="pull-left" style="margin-left: 20px">
            <span class="text-muted">Page 1 of 1. Total results: 1</span>
        </div>
        <div class="pull-right">
            <button class="btn btn-default" title="First Page" disabled>
                <i class="fa fa-angle-double-left"></i>
            </button>
            <button class="btn btn-default" title="Previous Page" disabled>
                <i class="fa fa-angle-left"></i>
            </button>
            <button class="btn btn-default" title="Next Page" disabled>
                <i class="fa fa-angle-right"></i>
            </button>
            <button class="btn btn-default" title="Last Page" disabled>
                <i class="fa fa-angle-double-right"></i>
            </button>
        </div>
    </div>
</div>
{% endblock %}

{% block extra_js %}
<script>
    var selectedCount = 0;
    function handleCheckboxChange() {
        console.log('Checkbox changed');
        const checkboxes = document.querySelectorAll('input[type="checkbox"].client-checkbox');
        const deleteButton = document.getElementById('delete-button');
        const editButton = document.getElementById('edit-button');
        selectedCount = 0;
        let selectedClientId = null;

        checkboxes.forEach(checkbox => {
            if (checkbox.checked) {
                selectedCount++;
                selectedClientId = checkbox.value;
            }
        });
       console.log(selectedCount);
        if (selectedCount == 1) {
            deleteButton.disabled = false;
            deleteButton.dataset.clientId = selectedClientId;
            editButton.disabled = false;
            editButton.dataset.clientId = selectedClientId;
        } else {
            deleteButton.disabled = true;
            deleteButton.dataset.clientId = '';
            editButton.disabled = true;
            editButton.dataset.clientId = '';
            toaster();
        }
    }
    
    function toaster(msg = 'Please select only one client to edit or delete') {
        console.log('Toaster');
        setTimeout(function() {
            
                toastr.options = {
                    closeButton: true,
                    progressBar: true,
                    showMethod: 'slideDown',
                    timeOut: 4000
                };
                toastr.success(msg);

            }, 1300);
    }

    function handleDelete() {
        if (!confirm('Are you sure you want to delete this client?')) {
            return;
        }
        if (selectedCount == 1) {
            const clientId = document.getElementById('delete-button').dataset.clientId;
            if (clientId) {
                window.location.href = `/clients/delete/${clientId}`;
                toaster('Client deleted successfully');
            }
        } else {
            toaster('Please select only one client to delete');
        }
        
    }

    function handleEdit() {
        if (selectedCount != 1) {
            toaster();
            return;
        }
        const clientId = document.getElementById('edit-button').dataset.clientId;
        if (clientId) {
            window.location.href = `/clients/edit/${clientId}`;
        }
    }
</script>
{% endblock %}
{% extends "layouts/dashboard.html" %}

{% block title %}Client page{% endblock %}

    {% block extra_css %}
        <link rel="stylesheet" href="{{ url_for('static', path='/css/client.css') }}">
        <link rel="stylesheet" href="{{ url_for('static', path='/css/facture.css') }}">
    {% endblock %}

{% block content %}

         <!-- Form Actions -->
         <div class="form-actions">
            <div class="text-right">
                <button type="button" class="btn btn-default">Cancel</button>
                <button type="submit" class="btn btn-primary">Save</button>
            </div>
        </div>
<div class="container">
    <div class="scrollable-container">
        <div class="row">
            <div class="col-md-4">
                <div class="panel panel-default">
                    <div class="panel-body">
                        <div class="form-group">
                            <label>Client</label>
                            <div class="input-group">
                                <input type="text" class="form-control" value="karam">
                                <span class="input-group-addon">
                                <i class="fa fa-times"></i>
                                </span>
                            </div>
                        </div>
                        <div class="form-group">
                            <label>Client Email</label>
                            <div class="input-group">
                                <input type="text" class="form-control" value="karam@gmail.com">
                                <span class="input-group-addon">
                                <i class="fa fa-times"></i>
                                </span>
                            </div>
                        </div>
                        <div class="form-group">
                            <label>Select Enterprise</Select></label>
                            <select class="form-control">
                                <option>Revotech</option>
                                <option>Greeta</option>
                            </select>
                        </div>
                        <div class="help-block">
                            <a href="addClient"><i class="fa fa-pencil"></i> Edit Client</a> /
                            <a href="client">View in Portal</a>
                        </div>
                    </div>
                </div>
            </div>

            <div class="col-md-4">
                <div class="panel panel-default">
                <div class="panel-body">
                    <div class="form-group">
                    <label>Invoice Date</label>
                    <input type="date" class="form-control" value="2024-12-26">
                    </div>
                    <div class="form-group">
                    <label>Due Date</label>
                    <input type="date" class="form-control">
                    </div>
                    <div class="form-group">
                    <label>Partial/Deposit</label>
                    <input type="text" class="form-control">
                    </div>
                </div>
                </div>
            </div>

            <div class="col-md-4">
                <div class="panel panel-default">
                <div class="panel-body">
                    <div class="form-group">
                    <label>Invoice #</label>
                    <input type="text" class="form-control">
                    </div>
                    <div class="form-group">
                    <label>PO #</label>
                    <input type="text" class="form-control">
                    </div>
                    <div class="form-group">
                    <div class="row">
                        <div class="col-xs-6">
                            <label>TVA</label>
                            <input type="number" class="form-control" value="20">
                        </div>
                        <div class="col-xs-6">
                            <label>Payment Mode</label>
                            <select class="form-control">
                                <option>...</option>
                                <option>Espace</option>
                                <option>Cheque</option>
                                <option>Virement</option>
                            </select>
                        </div>
                    </div>
                    </div>
                </div>
                </div>
            </div>
        </div> <!-- /.row -->
        <div class="table-responsive">
            <table class="table table-striped table-hover">
                <thead>
                    <tr>
                        <th>ITEM</th>
                        <th>DESCRIPTION</th>
                        <th>UNIT COST</th>
                        <th>QUANTITY</th>
                        <th>LINE TOTAL</th>
                      </tr>
                </thead>
                <tbody id="tableBody">
                    <tr class="item-row">
                        <td><input type="text" class="form-control"></td>
                        <td><input type="text" class="form-control"></td>
                        <td><input type="number" class="form-control" placeholder="0.00"></td>
                        <td><input type="number" class="form-control" placeholder="0"></td>
                        <td>0.00 €</td>
                    </tr>
                </tbody>
            </table>
            <button class="btn btn-primary add-item-btn">
                <span class="glyphicon glyphicon-plus"></span> Add Item
              </button>
    </div>
    
</div>
{% include 'components/cards/facture.html' %}
{% endblock %}
{% block extra_js %}
<script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
<script>
  $(document).ready(function() {
    $('.add-item-btn').click(function() {
      // Clone the first row as a template
      var $newRow = $('.item-row:first').clone();

      // Clear input fields in the new row
      $newRow.find('input[type="text"]').val('');
      $newRow.find('input[type="number"]').val('');

      // Set initial line total to 0.00
      $newRow.find('.line-total').text('0.00 €');

      // Append the new row to the table body
      $('#tableBody').append($newRow);

      // Bind the calculateLineTotal function to the new row's input change event
      $newRow.find('input[type="number"]').on('input', calculateLineTotal);
    });

    function calculateLineTotal(event) {
      // Get the current row where the input change happened
      console.log('calculateLineTotal');
      var $row = $(this).closest('.item-row');

      // Handle potential invalid input (e.g., non-numeric characters)
      var unitCost = parseFloat($row.find('input[type="number"]:eq(0)').val()) || 0;
      var quantity = parseFloat($row.find('input[type="number"]:eq(1)').val()) || 0;

      // Calculate line total (ensure non-negative valuepos)
      var lineTotal = Math.max(0, unitCost * quantity);

      // Update line total text with formatted currency
      $row.find('.line-total').text(lineTotal.toFixed(2) + ' €');
    }

    // Calculate line totals on page load (optional)
    calculateLineTotals();

    // Recalculate line totals on any input change within an item row
    $(document).on('input', '.item-row input[type="number"]', calculateLineTotal);
  });
</script>
{% endblock %}